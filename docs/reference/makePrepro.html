<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create data tab preprocess methods — makePrepro • systemPipeShiny</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Create data tab preprocess methods — makePrepro" />
<meta property="og:description" content="On a data tab, given the same uploaded data set,
users can choose different ways to preprocess the data and therefore
different preprocessing methods will lead to different plot tab options.
Every call of this function defines a preprocess method: 1. data
validation expression before preprocess; 2. actual preprocess expression; 3.
plot options after preprocess." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">systemPipeShiny</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/systemPipeShiny.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/systemPipeR/systemPipeShiny/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create data tab preprocess methods</h1>
    <small class="dont-index">Source: <a href='https://github.com/systemPipeR/systemPipeShiny/blob/master/R/spsNewtab.R'><code>R/spsNewtab.R</code></a></small>
    <div class="hidden name"><code>makePrepro.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>On a data tab, given the same uploaded data set,
users can choose different ways to preprocess the data and therefore
different preprocessing methods will lead to different plot tab options.
Every call of this function defines a preprocess method: 1. data
validation expression before preprocess; 2. actual preprocess expression; 3.
plot options after preprocess.</p>
    </div>

    <pre class="usage"><span class='fu'>makePrepro</span><span class='op'>(</span>
  method_id <span class='op'>=</span> <span class='st'>"md1"</span>,
  label <span class='op'>=</span> <span class='st'>"New method1"</span>,
  vd_expr <span class='op'>=</span> <span class='fu'><a href='spsValidate.html'>spsValidate</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>is.data.frame</a></span><span class='op'>(</span><span class='va'>data_filtered</span><span class='op'>)</span><span class='op'>)</span>,
  pre_expr <span class='op'>=</span> <span class='op'>{</span>     <span class='va'>data_filtered</span> <span class='op'>}</span>,
  plot_options <span class='op'>=</span> <span class='st'>"default"</span>,
  use_string <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>method_id</th>
      <td><p>string, length 1, a unique ID within this data tab.</p></td>
    </tr>
    <tr>
      <th>label</th>
      <td><p>string, length 1, what label to display on UI for users to
choose as a preprocess option</p></td>
    </tr>
    <tr>
      <th>vd_expr</th>
      <td><p>expression, usually a <a href='spsValidate.html'>spsValidate</a> object. Before preprocess
if there is any additional validation that is special to this preprocess
method, you can specify here</p></td>
    </tr>
    <tr>
      <th>pre_expr</th>
      <td><p>The actual preprocess expression. You should use
a pre-created variable called <em>data_filtered</em> to start and this is the
object that contains filtered data after users filtering on the UI. In the
end of this expression, you should return a preprocessed dataframe or
whatever object type that can be accepted by the desired plot tab. It is
recommended to write the preprocess method into a function and directly call
the function here, e.g.</p><pre><span class='va'>myPreprocess</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span><span class='op'>{</span>
    <span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>is.numeric</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>[</span> ,<span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
        <span class='va'>data</span><span class='op'>[</span> ,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>data</span><span class='op'>[</span> ,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='fl'>1</span>
    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>makePrepro</span><span class='op'>(</span>
 <span class='va'>...</span>,
 pre_expr <span class='op'>=</span> <span class='fu'>myPreprocess</span><span class='op'>(</span><span class='va'>data_filtered</span><span class='op'>)</span>,
 <span class='va'>...</span>
<span class='op'>)</span>
</pre></td>
    </tr>
    <tr>
      <th>plot_options</th>
      <td><p>plot tab IDs: if data is preprocessed by this method,
what kind of plots it can make, specify plot tab IDs in a vector. Note:
unlike the <em>receive_datatab_ids</em> argument in <a href='makePlotData.html'>makePlotData</a> that requires
the <em>config/tabs.csv</em> exists, this argument doesn't require the config file
or the plot tab to be existing. You can use any ID(s) here. The ID checking
is postponed when the <a href='genGallery.html'>genGallery</a> function runs on app start. "default"
means all possible plot tabs, the same as <em>type = 'plot'</em> in <a href='genGallery.html'>genGallery</a>.</p></td>
    </tr>
    <tr>
      <th>use_string</th>
      <td><p>same as the argument in <a href='newTabPlot.html'>newTabPlot</a>, controls
<em>vd_expr</em> and <em>pre_expr</em> in this function</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a special list that contains all info for a preprocess method</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>for <em>vd_expr</em>, <em>pre_expr</em> a variable called <em>data_filtered</em> is
accessible and is the object where data stored. One should use this
object to do validation or preprocess. See examples.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='spsInit.html'>spsInit</a></span><span class='op'>(</span>change_wd <span class='op'>=</span> <span class='cn'>FALSE</span>, overwrite <span class='op'>=</span> <span class='cn'>TRUE</span>, project_name <span class='op'>=</span> <span class='st'>"SPS_prepro"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'><span style='color: #0000BB;font-weight: bold;'>[SPS-INFO] 2020-09-29 17:09:56 Start to create a new SPS project</span><span></span></div><div class='output co'>#&gt; <span class='warning'>Warning: </span><span style='color: #FFAF00;font-weight: bold;'>[SPS-WARNING] 2020-09-29 17:09:56 Overwrite things in /home/dcassol/danielac@ucr.edu/testing/systemPipeShiny/docs/reference/SPS_prepro</span><span></span></div><div class='output co'>#&gt; <span class='message'></span><span style='color: #0000BB;font-weight: bold;'>[SPS-INFO] 2020-09-29 17:09:56 Now copy files</span><span></span></div><div class='output co'>#&gt; <span class='message'></span><span style='color: #0000BB;font-weight: bold;'>[SPS-INFO] 2020-09-29 17:09:56 Create SPS database</span><span></span></div><div class='output co'>#&gt; <span class='message'></span><span style='color: #0000BB;font-weight: bold;'>[SPS-INFO] 2020-09-29 17:09:56 Created SPS database method container</span><span></span></div><div class='output co'>#&gt; <span class='message'></span><span style='color: #0000BB;font-weight: bold;'>[SPS-INFO] 2020-09-29 17:09:56 Creating SPS db...</span><span></span></div><div class='output co'>#&gt; </span><span style='color: #BB0000;font-weight: bold;'>[SPS-DANGER] 2020-09-29 17:09:56 Db created at '/home/dcassol/danielac@ucr.edu/testing/systemPipeShiny/docs/reference/SPS_prepro/config/sps.db'. DO NOT share this file with others</span><span>
#&gt; </span><span style='color: #FFAF00;font-weight: bold;'>[SPS-INFO] 2020-09-29 17:09:56 Key md5 efdd077f02f5d5318e8d4885489e4d50</span><span>
#&gt; </span><span style='color: #00BB00;font-weight: bold;'>[SPS-INFO] 2020-09-29 17:09:56 SPS project setup done!</span><span></div><div class='input'><span class='co'># first preprocess method</span>
<span class='va'>prepro_log</span> <span class='op'>&lt;-</span> <span class='fu'>makePrepro</span><span class='op'>(</span>
    <span class='st'>"log"</span>, <span class='st'>"take log of first column"</span>,
    vd_expr <span class='op'>=</span> <span class='fu'><a href='spsValidate.html'>spsValidate</a></span><span class='op'>(</span><span class='op'>{</span>
        <span class='kw'>if</span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>is.data.frame</a></span><span class='op'>(</span><span class='va'>data_filtered</span><span class='op'>)</span><span class='op'>)</span>
            <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"Input input data need to be a dataframe"</span><span class='op'>)</span>
    <span class='op'>}</span>, vd_name <span class='op'>=</span> <span class='st'>"log method pre-checks"</span><span class='op'>)</span>,
    pre_expr <span class='op'>=</span> <span class='op'>{</span>
        <span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>is.numeric</a></span><span class='op'>(</span><span class='va'>data_filtered</span><span class='op'>[</span> ,<span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
            <span class='op'>{</span><span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span><span class='op'>(</span><span class='va'>data_filtered</span><span class='op'>[</span> ,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
                <span class='va'>data_filtered</span><span class='op'>[</span> ,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>data_filtered</span><span class='op'>[</span> ,<span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span><span class='op'>}</span>
            <span class='op'>}</span>
        <span class='va'>data_filtered</span>
    <span class='op'>}</span>,
    plot_options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"plot_xx1"</span>, <span class='st'>"plot_xx2"</span><span class='op'>)</span>
    <span class='op'>)</span>
<span class='co'>## remember to save these helper functions in a R scripts under the R</span>
<span class='co'>## folder. They will be automatically sourced when app starts.</span>
<span class='va'>myPreprocess</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span><span class='op'>{</span>
    <span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>is.numeric</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>[</span> ,<span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
        <span class='va'>data</span><span class='op'>[</span> ,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>data</span><span class='op'>[</span> ,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='fl'>1</span>
    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>myVd</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>vd_name</span><span class='op'>)</span><span class='op'>{</span>
    <span class='fu'><a href='spsValidate.html'>spsValidate</a></span><span class='op'>(</span><span class='op'>{</span>
        <span class='kw'>if</span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>is.data.frame</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span><span class='op'>)</span>
            <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"Input input data need to be a dataframe"</span><span class='op'>)</span>
    <span class='op'>}</span>, vd_name <span class='op'>=</span> <span class='va'>vd_name</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># second preprocess method</span>
<span class='va'>prepro_addone</span> <span class='op'>&lt;-</span> <span class='fu'>makePrepro</span><span class='op'>(</span>
    <span class='st'>"addone"</span>, <span class='st'>"add one to first column"</span>,
    vd_expr <span class='op'>=</span> <span class='fu'>myVd</span><span class='op'>(</span><span class='va'>data_filtered</span>, <span class='st'>"add one method pre-checks"</span><span class='op'>)</span>,
    pre_expr <span class='op'>=</span> <span class='fu'>myPreprocess</span><span class='op'>(</span><span class='va'>data_filtered</span><span class='op'>)</span>,
    plot_options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"plot_xx1"</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='co'># Combine two methods and make a new data tab</span>
<span class='fu'><a href='newTabPlot.html'>newTabData</a></span><span class='op'>(</span><span class='st'>"data_test1"</span>,  <span class='st'>"test 1"</span>,
           app_path <span class='op'>=</span> <span class='st'>"SPS_prepro"</span>,
           prepro_methods <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>prepro_log</span>, <span class='va'>prepro_addone</span><span class='op'>)</span>
           <span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='error'>Error: </span><span style='color: #BB0000;font-weight: bold;'>[SPS-ERROR] 2020-09-29 17:09:56 File SPS_prepro/R/tab_vs_data_test1.R exists.</span><span></span></div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://lezhang.me/'>Le Zhang</a>, <a href='https://www.dcassol.com/'>Daniela Cassol</a>, <a href='https://github.com/mathrj'>Ponmathi Ramasamy</a>, <a href='https://github.com/jianhaizhang'>Jianhai Zhang</a>, <a href='https://github.com/gdmosher'>Gordon Mosher</a>, <a href='http://girke.bioinformatics.ucr.edu/'>Thomas Girke</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


